# Система анимированного перемещения персонажей

## Описание

Система позволяет создавать плавную анимацию перемещения персонажей на экране при помощи параметров `from`, `position` и `duration`.

## Синтаксис

```json
{
  "type": "show",
  "character": "character-id",
  "position": {"l": 20, "r": "auto"},
  "from": {"l": -25},
  "duration": 2000,
  "class": "optional-css-class"
}
```

## Параметры

### Обязательные
- **type** (строка): `"show"` - тип шага
- **character** (строка): ID персонажа для отображения

### Опциональные
- **position** (объект): конечная позиция персонажа
  - `l` - левая позиция в процентах
  - `r` - правая позиция в процентах
  - `t` - верхняя позиция в процентах  
  - `b` - нижняя позиция в процентах
  - Значения могут быть числами (автоматически преобразуются в %) или строками (для специальных значений вроде "auto")

- **from** (объект): начальная позиция для анимации (использует же формат, что и `position`)
  - Если указан, персонаж появится с этой позиции и переместится на `position`

- **duration** (число): длительность анимации в миллисекундах
  - **По умолчанию: 1000** (если указан `from`, но `duration` не указан)
  - Если `from` не указан, `duration` игнорируется

- **class** (строка): дополнительный CSS класс для персонажа

## Примеры

### Пример 1: Простое появление персонажа без анимации

```json
{
  "type": "show",
  "character": "mc",
  "position": {"l": 20}
}
```

### Пример 2: Появление с анимацией слева (движение из левого края)

```json
{
  "type": "show",
  "character": "mc",
  "position": {"l": 20},
  "from": {"l": -25},
  "duration": 2000
}
```

Персонаж начнет с левой позиции -25% (вне экрана слева) и переместится на 20% за 2 секунды.

### Пример 3: Появление справа с CSS классом

```json
{
  "type": "show",
  "character": "npc",
  "position": {"r": 15},
  "from": {"r": -30},
  "duration": 1500,
  "class": "big-char fade-in"
}
```

### Пример 4: Поведение по умолчанию (duration = 1000ms)

```json
{
  "type": "show",
  "character": "character",
  "position": {"l": 50},
  "from": {"l": 0}
}
```

Поскольку `duration` не указан, будет использовано значение 1000ms.

## Сложные сценарии

### Несколько персонажей с последовательной анимацией

```json
{
  "id": "scene_with_characters",
  "steps": [
    {
      "type": "scene",
      "id": "room"
    },
    {
      "type": "show",
      "character": "hero",
      "position": {"l": 20},
      "from": {"l": -50},
      "duration": 1500
    },
    {
      "type": "show",
      "character": "ally",
      "position": {"r": 20},
      "from": {"r": -50},
      "duration": 1500
    },
    {
      "type": "dialogue",
      "character": "hero",
      "text": "Привет!"
    }
  ]
}
```

### Анимация с разными скоростями

```json
{
  "type": "show",
  "character": "fast-char",
  "position": {"l": 30},
  "from": {"l": -30},
  "duration": 800
}
```

```json
{
  "type": "show",
  "character": "slow-char",
  "position": {"r": 30},
  "from": {"r": -30},
  "duration": 3000
}
```

## Технические детали

### Как это работает

1. При обработке шага `"show"` функция `showCharacter()` в `useVisualNovel.js` сохраняет:
   - `character.fromPosition` - начальная позиция
   - `character.position` - конечная позиция
   - `character.animationDuration` - длительность анимации

2. В компоненте `Character.vue`:
   - При обнаружении `fromPosition` компонент сначала показывает персонажа в начальной позиции
   - На следующий tick добавляется CSS `transition`
   - Затем применяется конечная позиция
   - CSS transition плавно анимирует движение

3. Анимация использует `ease-in-out` функцию плавности

### CSS свойства

Анимируемые свойства:
- `left` - левая позиция
- `right` - правая позиция
- `top` - верхняя позиция
- `bottom` - нижняя позиция
- `scale` - масштаб (если указан)

## Примечания

1. **Размер в процентах**: Числовые значения в `position` и `from` автоматически преобразуются в проценты, поэтому `"l": 20` становится `"left: 20%"`

2. **Строковые значения**: Вы можете использовать строковые значения для специальных CSS значений, например `"r": "auto"`

3. **Позиция по умолчанию**: Если позиция не указана, персонаж появится с координатами `left: 0; bottom: 0`

4. **Выход персонажа**: Используйте отрицательные значения в `position` для того, чтобы переместить персонажа вне видимой области

5. **Одновременные анимации**: Несколько персонажей могут анимироваться одновременно - просто добавьте несколько шагов `"show"` подряд

## Отладка

В консоли браузера вы можете проверить:
- `character.fromPosition` - начальная позиция
- `character.animationDuration` - длительность
- Класс `transition` применяется динамически при анимации
